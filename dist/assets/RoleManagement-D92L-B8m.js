import{b as e,d as t,e as n,f as r,g as i}from"./useAccountsQuery-CgQ5mwMD.js";import{ap as a,av as o,b9 as s,bC as c,bE as l,bF as ee,bJ as u,bL as d,bS as f,bZ as te,ba as p,bb as m,bc as h,bd as ne,be as g,bg as _,bh as v,bi as y,bt as b,bv as x,bx as S,by as re,c0 as C,e as w}from"./index-BCk1CcfA.js";import{b as ie}from"./SideNavbar-CHqNkm4k.js";import"./css-zdK3R9k8.js";const ae={class:`flex h-screen bg-gray-50`},oe={class:`flex-1 flex overflow-hidden`},se={class:`w-72 border-r bg-white overflow-y-auto`},ce=[`onClick`],le={class:`flex-1 overflow-y-auto p-6 space-y-6`},ue={class:`bg-white rounded-2xl border border-gray-200 p-6 shadow-sm`},de={class:`flex flex-col md:flex-row md:items-center md:justify-between gap-4`},fe={class:`text-3xl font-semibold text-gray-900`},pe={class:`text-gray-500 mt-2 max-w-2xl`},me={class:`grid md:grid-cols-2 gap-6 mt-8`},he={class:`border border-gray-100 rounded-xl p-5`},T={key:0,class:`grid grid-cols-1 sm:grid-cols-2 gap-2 text-sm text-gray-600`},E={key:1,class:`text-gray-400 text-sm`},D={class:`border border-gray-100 rounded-xl p-5`},O={class:`space-y-2 text-sm text-gray-600`},k={class:`flex justify-between`},A={class:`font-medium`},j={class:`flex justify-between`},M={class:`font-medium`},N={class:`flex justify-between`},P={class:`font-medium`},F={class:`bg-white rounded-2xl border border-gray-200 p-6 shadow-sm`},I={class:`flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6`},L={class:`flex flex-col`},R={class:`font-medium text-gray-900`},ge={class:`text-xs text-gray-500`},_e={class:`text-sm text-gray-600`},ve={class:`text-sm text-gray-600`},ye={class:`space-y-4`};var z=y({__name:`RoleManagement`,setup(y){let z=a(),B=d(null),V=d(``),H=d(!1),U=d([]),W=d(!1),G=u({user_id:``,expires_at:null,note:``}),K=i(),be=n(B),q=r(B),J=e(),xe=t();c(()=>K.data.value,e=>{!B.value&&e?.length&&(B.value=e[0].slug)},{immediate:!0});let Y=p(()=>B.value?K.data.value?.find(e=>e.slug===B.value)??null:null),X=p(()=>be.data.value?.permissions??[]),Z=p(()=>q.data.value?.results??[]),Q=p(()=>{if(!V.value)return Z.value;let e=V.value.toLowerCase();return Z.value.filter(t=>{let n=t.user?.username||``,r=t.user?.email||``;return n.toLowerCase().includes(e)||r.toLowerCase().includes(e)})}),$=p(()=>z.can(`role.assign`,!1)),Se=()=>{!$.value||!B.value||(H.value=!0)},Ce=async e=>{if(!e){U.value=[];return}W.value=!0;try{let t=await o({search:e,page_size:5});U.value=t.results}finally{W.value=!1}},we=async()=>{if(!G.user_id||!B.value){w.warning(`Select a user to assign`);return}try{await J.mutateAsync({user_id:G.user_id,role_slug:B.value,expires_at:G.expires_at,note:G.note}),w.success(`Member added to role`),H.value=!1,G.user_id=``,G.expires_at=null,G.note=``}catch{w.error(`Failed to assign role`)}},Te=async e=>{try{await xe.mutateAsync({user_id:e.user_id,role_slug:e.role_slug}),w.success(`Member removed`)}catch{w.error(`Failed to revoke role`)}};return(e,t)=>{let n=S(`el-tag`),r=S(`el-button`),i=S(`el-input`),a=S(`el-table-column`),o=S(`el-table`),c=S(`el-option`),u=S(`el-select`),d=S(`el-date-picker`),p=S(`el-drawer`),y=re(`loading`);return b(),g(s,null,[m(`div`,ae,[v(ie,{class:`hidden md:flex`}),m(`main`,oe,[m(`aside`,se,[t[6]||=m(`div`,{class:`p-4 border-b`},[m(`h2`,{class:`text-sm uppercase text-gray-400 tracking-widest`},`Roles`)],-1),m(`ul`,null,[(b(!0),g(s,null,x(f(K).data.value,e=>(b(),g(`li`,{key:e.slug,class:te([`px-4 py-3 cursor-pointer border-b border-gray-50 flex justify-between items-center`,B.value===e.slug?`bg-gray-100 font-medium`:`hover:bg-gray-50`]),onClick:t=>B.value=e.slug},[m(`span`,null,C(e.name),1),v(n,{size:`small`,type:`info`},{default:l(()=>[_(C(e.member_count??0),1)]),_:2},1024)],10,ce))),128))])]),m(`section`,le,[m(`div`,ue,[m(`div`,de,[m(`div`,null,[t[7]||=m(`p`,{class:`text-sm text-gray-500 uppercase tracking-widest`},`Role overview`,-1),m(`h1`,fe,C(Y.value?.name||`Select a role`),1),m(`p`,pe,C(Y.value?.description||`Choose a role to inspect permissions and members.`),1)]),$.value?(b(),h(r,{key:0,size:`large`,type:`primary`,class:`self-start`,disabled:!B.value,onClick:Se},{default:l(()=>t[8]||=[_(` Add member `,-1)]),_:1,__:[8]},8,[`disabled`])):ne(``,!0)]),m(`div`,me,[m(`div`,he,[t[9]||=m(`h3`,{class:`text-sm font-semibold text-gray-700 mb-3`},`Permissions`,-1),X.value.length?(b(),g(`div`,T,[(b(!0),g(s,null,x(X.value,e=>(b(),g(`div`,{key:e,class:`px-3 py-2 rounded-lg bg-gray-50 border border-gray-100`},C(e),1))),128))])):(b(),g(`p`,E,`No permissions assigned.`))]),m(`div`,D,[t[13]||=m(`h3`,{class:`text-sm font-semibold text-gray-700 mb-3`},`Role metadata`,-1),m(`ul`,O,[m(`li`,k,[t[10]||=m(`span`,null,`Slug`,-1),m(`span`,A,C(Y.value?.slug||`—`),1)]),m(`li`,j,[t[11]||=m(`span`,null,`Priority`,-1),m(`span`,M,C(Y.value?.priority??`—`),1)]),m(`li`,N,[t[12]||=m(`span`,null,`Members`,-1),m(`span`,P,C(Z.value.length),1)])])])])]),m(`div`,F,[m(`div`,I,[t[14]||=m(`div`,null,[m(`h2`,{class:`text-xl font-semibold text-gray-900`},`Members`),m(`p`,{class:`text-sm text-gray-500`},`Users currently assigned to this role`)],-1),v(i,{modelValue:V.value,"onUpdate:modelValue":t[0]||=e=>V.value=e,placeholder:`Search members`,"prefix-icon":`Search`,size:`large`,class:`w-full md:w-64`},null,8,[`modelValue`])]),ee((b(),h(o,{data:Q.value,"empty-text":`No members yet`,border:``},{default:l(()=>[v(a,{label:`User`,"min-width":`220`},{default:l(({row:e})=>[m(`div`,L,[m(`span`,R,C(e.user?.username||e.user?.email||e.user_id),1),m(`span`,ge,C(e.user?.email),1)])]),_:1}),v(a,{label:`Joined`,width:`180`},{default:l(({row:e})=>[m(`span`,_e,C(e.created_at?new Date(e.created_at).toLocaleDateString():`—`),1)]),_:1}),v(a,{label:`Expires`,width:`180`},{default:l(({row:e})=>[m(`span`,ve,C(e.expires_at?new Date(e.expires_at).toLocaleDateString():`—`),1)]),_:1}),v(a,{label:`Actions`,width:`150`,align:`right`},{default:l(({row:e})=>[v(r,{size:`small`,type:`danger`,plain:``,disabled:!$.value,onClick:t=>Te(e)},{default:l(()=>t[15]||=[_(` Remove `,-1)]),_:2,__:[15]},1032,[`disabled`,`onClick`])]),_:1})]),_:1},8,[`data`])),[[y,f(q).isLoading.value]])])])])]),v(p,{modelValue:H.value,"onUpdate:modelValue":t[5]||=e=>H.value=e,title:`Add member to ${Y.value?.name??``}`,size:`420px`},{footer:l(()=>[v(r,{onClick:t[4]||=e=>H.value=!1},{default:l(()=>t[19]||=[_(`Cancel`,-1)]),_:1,__:[19]}),v(r,{type:`primary`,loading:f(J).isPending.value,onClick:we},{default:l(()=>t[20]||=[_(` Add member `,-1)]),_:1,__:[20]},8,[`loading`])]),default:l(()=>[m(`div`,ye,[m(`div`,null,[t[16]||=m(`label`,{class:`text-sm font-medium text-gray-700 mb-1 block`},`User`,-1),v(u,{modelValue:G.user_id,"onUpdate:modelValue":t[1]||=e=>G.user_id=e,filterable:``,remote:``,"reserve-keyword":``,placeholder:`Search by email`,class:`w-full`,"remote-method":Ce,loading:W.value},{default:l(()=>[(b(!0),g(s,null,x(U.value,e=>(b(),h(c,{key:e.id,label:`${e.username||e.email} · ${e.email}`,value:e.id},null,8,[`label`,`value`]))),128))]),_:1},8,[`modelValue`,`loading`])]),m(`div`,null,[t[17]||=m(`label`,{class:`text-sm font-medium text-gray-700 mb-1 block`},`Expiration`,-1),v(d,{modelValue:G.expires_at,"onUpdate:modelValue":t[2]||=e=>G.expires_at=e,type:`date`,placeholder:`Optional expiration`,class:`w-full`,"value-format":`YYYY-MM-DD`},null,8,[`modelValue`])]),m(`div`,null,[t[18]||=m(`label`,{class:`text-sm font-medium text-gray-700 mb-1 block`},`Note`,-1),v(i,{modelValue:G.note,"onUpdate:modelValue":t[3]||=e=>G.note=e,type:`textarea`,rows:3,placeholder:`Optional context for this membership`},null,8,[`modelValue`])])])]),_:1},8,[`modelValue`,`title`])],64)}}}),B=z;export{B as default};