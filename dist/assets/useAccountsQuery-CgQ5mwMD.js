import{a$ as e,aL as t,aM as n,aN as r,aO as i,aP as a,aQ as o,aR as s,aS as c,aT as l,aU as u,aV as d,aW as f,aX as p,aY as m,aZ as h,a_ as g,ar as _,as as v,at as y,au as b,av as x,aw as S,ax as C,b0 as w,b1 as T,bC as E,bI as D,bJ as O,bK as k,bM as A,bN as j,bQ as M,bR as N,ba as P,bl as F,bm as I}from"./index-BCk1CcfA.js";var L=class extends T{constructor(e,t){super(),this.options=t,this.#client=e,this.#selectError=null,this.#currentThenable=s(),this.options.experimental_prefetchInRender||this.#currentThenable.reject(Error(`experimental_prefetchInRender feature flag is not enabled`)),this.bindMethods(),this.setOptions(t)}#client;#currentQuery=void 0;#currentQueryInitialState=void 0;#currentResult=void 0;#currentResultState;#currentResultOptions;#currentThenable;#selectError;#selectFn;#selectResult;#lastQueryWithDefinedData;#staleTimeoutId;#refetchIntervalId;#currentRefetchInterval;#trackedProps=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#currentQuery.addObserver(this),z(this.#currentQuery,this.options)?this.#executeFetch():this.updateResult(),this.#updateTimers())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return B(this.#currentQuery,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return B(this.#currentQuery,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#clearStaleTimeout(),this.#clearRefetchInterval(),this.#currentQuery.removeObserver(this)}setOptions(e){let t=this.options,n=this.#currentQuery;if(this.options=this.#client.defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!=`boolean`&&typeof this.options.enabled!=`function`&&typeof m(this.options.enabled,this.#currentQuery)!=`boolean`)throw Error(`Expected enabled to be a boolean or a callback that returns a boolean`);this.#updateQuery(),this.#currentQuery.setOptions(this.options),t._defaulted&&!g(this.options,t)&&this.#client.getQueryCache().notify({type:`observerOptionsUpdated`,query:this.#currentQuery,observer:this});let r=this.hasListeners();r&&V(this.#currentQuery,n,this.options,t)&&this.#executeFetch(),this.updateResult(),r&&(this.#currentQuery!==n||m(this.options.enabled,this.#currentQuery)!==m(t.enabled,this.#currentQuery)||h(this.options.staleTime,this.#currentQuery)!==h(t.staleTime,this.#currentQuery))&&this.#updateStaleTimeout();let i=this.#computeRefetchInterval();r&&(this.#currentQuery!==n||m(this.options.enabled,this.#currentQuery)!==m(t.enabled,this.#currentQuery)||i!==this.#currentRefetchInterval)&&this.#updateRefetchInterval(i)}getOptimisticResult(e){let t=this.#client.getQueryCache().build(this.#client,e),n=this.createResult(t,e);return U(this,n)&&(this.#currentResult=n,this.#currentResultOptions=this.options,this.#currentResultState=this.#currentQuery.state),n}getCurrentResult(){return this.#currentResult}trackResult(e,t){return new Proxy(e,{get:(e,n)=>(this.trackProp(n),t?.(n),Reflect.get(e,n))})}trackProp(e){this.#trackedProps.add(e)}getCurrentQuery(){return this.#currentQuery}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){let t=this.#client.defaultQueryOptions(e),n=this.#client.getQueryCache().build(this.#client,t);return n.fetch().then(()=>this.createResult(n,t))}fetch(e){return this.#executeFetch({...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#currentResult))}#executeFetch(e){this.#updateQuery();let t=this.#currentQuery.fetch(this.options,e);return e?.throwOnError||(t=t.catch(f)),t}#updateStaleTimeout(){this.#clearStaleTimeout();let e=h(this.options.staleTime,this.#currentQuery);if(u||this.#currentResult.isStale||!d(e))return;let t=w(this.#currentResult.dataUpdatedAt,e),n=t+1;this.#staleTimeoutId=setTimeout(()=>{this.#currentResult.isStale||this.updateResult()},n)}#computeRefetchInterval(){return(typeof this.options.refetchInterval==`function`?this.options.refetchInterval(this.#currentQuery):this.options.refetchInterval)??!1}#updateRefetchInterval(e){this.#clearRefetchInterval(),this.#currentRefetchInterval=e,!(u||m(this.options.enabled,this.#currentQuery)===!1||!d(this.#currentRefetchInterval)||this.#currentRefetchInterval===0)&&(this.#refetchIntervalId=setInterval(()=>{(this.options.refetchIntervalInBackground||c.isFocused())&&this.#executeFetch()},this.#currentRefetchInterval))}#updateTimers(){this.#updateStaleTimeout(),this.#updateRefetchInterval(this.#computeRefetchInterval())}#clearStaleTimeout(){this.#staleTimeoutId&&(clearTimeout(this.#staleTimeoutId),this.#staleTimeoutId=void 0)}#clearRefetchInterval(){this.#refetchIntervalId&&(clearInterval(this.#refetchIntervalId),this.#refetchIntervalId=void 0)}createResult(e,t){let n=this.#currentQuery,r=this.options,i=this.#currentResult,o=this.#currentResultState,c=this.#currentResultOptions,l=e!==n,u=l?e.state:this.#currentQueryInitialState,{state:d}=e,f={...d},h=!1,g;if(t._optimisticResults){let i=this.hasListeners(),o=!i&&z(e,t),s=i&&V(e,n,t,r);(o||s)&&(f={...f,...a(d.data,e.options)}),t._optimisticResults===`isRestoring`&&(f.fetchStatus=`idle`)}let{error:_,errorUpdatedAt:v,status:y}=f;g=f.data;let b=!1;if(t.placeholderData!==void 0&&g===void 0&&y===`pending`){let e;i?.isPlaceholderData&&t.placeholderData===c?.placeholderData?(e=i.data,b=!0):e=typeof t.placeholderData==`function`?t.placeholderData(this.#lastQueryWithDefinedData?.state.data,this.#lastQueryWithDefinedData):t.placeholderData,e!==void 0&&(y=`success`,g=p(i?.data,e,t),h=!0)}if(t.select&&g!==void 0&&!b)if(i&&g===o?.data&&t.select===this.#selectFn)g=this.#selectResult;else try{this.#selectFn=t.select,g=t.select(g),g=p(i?.data,g,t),this.#selectResult=g,this.#selectError=null}catch(e){this.#selectError=e}this.#selectError&&(_=this.#selectError,g=this.#selectResult,v=Date.now(),y=`error`);let x=f.fetchStatus===`fetching`,S=y===`pending`,C=y===`error`,w=S&&x,T=g!==void 0,E={status:y,fetchStatus:f.fetchStatus,isPending:S,isSuccess:y===`success`,isError:C,isInitialLoading:w,isLoading:w,data:g,dataUpdatedAt:f.dataUpdatedAt,error:_,errorUpdatedAt:v,failureCount:f.fetchFailureCount,failureReason:f.fetchFailureReason,errorUpdateCount:f.errorUpdateCount,isFetched:f.dataUpdateCount>0||f.errorUpdateCount>0,isFetchedAfterMount:f.dataUpdateCount>u.dataUpdateCount||f.errorUpdateCount>u.errorUpdateCount,isFetching:x,isRefetching:x&&!S,isLoadingError:C&&!T,isPaused:f.fetchStatus===`paused`,isPlaceholderData:h,isRefetchError:C&&T,isStale:H(e,t),refetch:this.refetch,promise:this.#currentThenable,isEnabled:m(t.enabled,e)!==!1},D=E;if(this.options.experimental_prefetchInRender){let t=e=>{D.status===`error`?e.reject(D.error):D.data!==void 0&&e.resolve(D.data)},r=()=>{let e=this.#currentThenable=D.promise=s();t(e)},i=this.#currentThenable;switch(i.status){case`pending`:e.queryHash===n.queryHash&&t(i);break;case`fulfilled`:(D.status===`error`||D.data!==i.value)&&r();break;case`rejected`:(D.status!==`error`||D.error!==i.reason)&&r();break}}return D}updateResult(){let e=this.#currentResult,t=this.createResult(this.#currentQuery,this.options);if(this.#currentResultState=this.#currentQuery.state,this.#currentResultOptions=this.options,this.#currentResultState.data!==void 0&&(this.#lastQueryWithDefinedData=this.#currentQuery),g(t,e))return;this.#currentResult=t;let n=()=>{if(!e)return!0;let{notifyOnChangeProps:t}=this.options,n=typeof t==`function`?t():t;if(n===`all`||!n&&!this.#trackedProps.size)return!0;let r=new Set(n??this.#trackedProps);return this.options.throwOnError&&r.add(`error`),Object.keys(this.#currentResult).some(t=>{let n=t,i=this.#currentResult[n]!==e[n];return i&&r.has(n)})};this.#notify({listeners:n()})}#updateQuery(){let e=this.#client.getQueryCache().build(this.#client,this.options);if(e===this.#currentQuery)return;let t=this.#currentQuery;this.#currentQuery=e,this.#currentQueryInitialState=e.state,this.hasListeners()&&(t?.removeObserver(this),e.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#updateTimers()}#notify(e){o.batch(()=>{e.listeners&&this.listeners.forEach(e=>{e(this.#currentResult)}),this.#client.getQueryCache().notify({query:this.#currentQuery,type:`observerResultsUpdated`})})}};function R(e,t){return m(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status===`error`&&t.retryOnMount===!1)}function z(e,t){return R(e,t)||e.state.data!==void 0&&B(e,t,t.refetchOnMount)}function B(e,t,n){if(m(t.enabled,e)!==!1&&h(t.staleTime,e)!==`static`){let r=typeof n==`function`?n(e):n;return r===`always`||r!==!1&&H(e,t)}return!1}function V(e,t,n,r){return(e!==t||m(r.enabled,e)===!1)&&(!n.suspense||e.state.status!==`error`)&&H(e,n)}function H(e,t){return m(t.enabled,e)!==!1&&e.isStaleByTime(h(t.staleTime,e))}function U(e,t){return!g(e.getCurrentResult(),t)}var W=class extends T{#client;#currentResult=void 0;#currentMutation;#mutateOptions;constructor(e,t){super(),this.#client=e,this.setOptions(t),this.bindMethods(),this.#updateResult()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){let t=this.options;this.options=this.#client.defaultMutationOptions(e),g(this.options,t)||this.#client.getMutationCache().notify({type:`observerOptionsUpdated`,mutation:this.#currentMutation,observer:this}),t?.mutationKey&&this.options.mutationKey&&l(t.mutationKey)!==l(this.options.mutationKey)?this.reset():this.#currentMutation?.state.status===`pending`&&this.#currentMutation.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#currentMutation?.removeObserver(this)}onMutationUpdate(e){this.#updateResult(),this.#notify(e)}getCurrentResult(){return this.#currentResult}reset(){this.#currentMutation?.removeObserver(this),this.#currentMutation=void 0,this.#updateResult(),this.#notify()}mutate(e,t){return this.#mutateOptions=t,this.#currentMutation?.removeObserver(this),this.#currentMutation=this.#client.getMutationCache().build(this.#client,this.options),this.#currentMutation.addObserver(this),this.#currentMutation.execute(e)}#updateResult(){let e=this.#currentMutation?.state??i();this.#currentResult={...e,isPending:e.status===`pending`,isSuccess:e.status===`success`,isError:e.status===`error`,isIdle:e.status===`idle`,mutate:this.mutate,reset:this.reset}}#notify(e){o.batch(()=>{if(this.#mutateOptions&&this.hasListeners()){let t=this.#currentResult.variables,n=this.#currentResult.context;e?.type===`success`?(this.#mutateOptions.onSuccess?.(e.data,t,n),this.#mutateOptions.onSettled?.(e.data,null,t,n)):e?.type===`error`&&(this.#mutateOptions.onError?.(e.error,t,n),this.#mutateOptions.onSettled?.(void 0,e.error,t,n))}this.listeners.forEach(e=>{e(this.#currentResult)})})}};function G(e=``){if(!F())throw Error(`vue-query hooks can only be used inside setup() function or functions that support injection context.`);let t=n(e),r=I(t);if(!r)throw Error(`No 'queryClient' found in Vue context, use 'VueQueryPlugin' to properly initialize the library.`);return r}function K(n,i,a){let o=a||G(),s=P(()=>{let e=t(i);typeof e.enabled==`function`&&(e.enabled=e.enabled());let n=o.defaultQueryOptions(e);return n._optimisticResults=o.isRestoring?.value?`isRestoring`:`optimistic`,n}),c=new n(o,s.value),l=s.value.shallow?A(c.getCurrentResult()):O(c.getCurrentResult()),u=()=>{};o.isRestoring&&E(o.isRestoring,e=>{e||(u(),u=c.subscribe(e=>{r(l,e)}))},{immediate:!0});let d=()=>{c.setOptions(s.value),r(l,c.getCurrentResult())};E(s,d),D(()=>{u()});let f=(...e)=>(d(),l.refetch(...e)),p=()=>new Promise((t,n)=>{let r=()=>{},i=()=>{if(s.value.enabled!==!1){c.setOptions(s.value);let i=c.getOptimisticResult(s.value);i.isStale?(r(),c.fetchOptimistic(s.value).then(t,r=>{e(s.value.throwOnError,[r,c.getCurrentQuery()])?n(r):t(c.getCurrentResult())})):(r(),t(i))}};i(),r=E(s,i)});E(()=>l.error,t=>{if(l.isError&&!l.isFetching&&e(s.value.throwOnError,[t,c.getCurrentQuery()]))throw t});let m=s.value.shallow?j(l):k(l),h=M(m);for(let e in l)typeof l[e]==`function`&&(h[e]=l[e]);return h.suspense=p,h.refetch=f,h}function q(e,t){return K(L,e,t)}function J(n,i){let a=i||G(),o=P(()=>a.defaultMutationOptions(t(n))),s=new W(a,o.value),c=o.value.shallow?A(s.getCurrentResult()):O(s.getCurrentResult()),l=s.subscribe(e=>{r(c,e)}),u=(e,t)=>{s.mutate(e,t).catch(()=>{})};E(o,()=>{s.setOptions(o.value)}),D(()=>{l()});let d=o.value.shallow?j(c):k(c),f=M(d);return E(()=>c.error,t=>{if(t&&e(o.value.throwOnError,[t]))throw t}),{...f,mutate:u,mutateAsync:c.mutate,reset:c.reset}}const Y={all:[`accounts`],me:()=>[...Y.all,`me`],users:e=>[...Y.all,`users`,e],roles:()=>[...Y.all,`roles`],role:e=>[...Y.all,`role`,e],roleMembers:e=>[...Y.all,`role-members`,e]};function X(e){return q({queryKey:Y.me(),queryFn:S,enabled:e?.enabled})}function Z(e={}){return q({queryKey:Y.users(N(e)),queryFn:()=>x(N(e))})}function Q(){return q({queryKey:Y.roles(),queryFn:b})}function $(e){return q({queryKey:P(()=>Y.role(N(e)??``)),queryFn:()=>v(N(e)),enabled:()=>!!N(e)})}function ee(e){return q({queryKey:P(()=>Y.roleMembers(N(e)??``)),queryFn:()=>y(N(e)),enabled:()=>!!N(e)})}function te(){let e=G();return J({mutationFn:e=>_(e),onSuccess:(t,n)=>{e.invalidateQueries({queryKey:Y.users()}),e.invalidateQueries({queryKey:Y.roleMembers(n.role_slug)}),n.role_slug&&e.invalidateQueries({queryKey:Y.role(n.role_slug)})}})}function ne(){let e=G();return J({mutationFn:e=>C(e),onSuccess:(t,n)=>{e.invalidateQueries({queryKey:Y.users()}),e.invalidateQueries({queryKey:Y.roleMembers(n.role_slug)}),n.role_slug&&e.invalidateQueries({queryKey:Y.role(n.role_slug)})}})}export{te as b,X as c,ne as d,$ as e,ee as f,Q as g,Z as h};