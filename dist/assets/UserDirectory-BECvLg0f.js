import{b as e,d as t,g as n,h as r}from"./useAccountsQuery-CgQ5mwMD.js";import{ap as i,b8 as a,b9 as o,bC as s,bE as c,bF as l,bJ as u,bL as d,bS as f,ba as p,bb as m,bc as h,bd as g,be as _,bg as v,bh as y,bi as b,bt as x,bv as S,bx as C,by as ee,bz as w,c0 as T,e as E}from"./index-BCk1CcfA.js";import{b as D}from"./SideNavbar-CHqNkm4k.js";import"./css-zdK3R9k8.js";const O={class:`flex h-screen bg-gray-50`},k={class:`flex-1 flex flex-col overflow-hidden`},A={class:`px-6 py-5 border-b bg-white flex flex-col gap-2`},j={class:`flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3`},M={class:`flex gap-3 flex-wrap`},N={class:`flex-1 overflow-auto px-6 py-6`},te={class:`flex items-center justify-between`},ne={class:`text-gray-500 text-sm`},re={class:`flex flex-col`},ie={class:`font-medium text-gray-900`},ae={class:`text-xs text-gray-500`},oe={class:`flex flex-wrap gap-2`},se={key:0,class:`text-xs text-gray-400`},P={class:`text-sm text-gray-600`},F={class:`flex items-center justify-between pt-4`},I={class:`text-sm text-gray-500`},L={class:`space-y-4`},R=20;var z=b({__name:`UserDirectory`,setup(b){let z=i(),B=u({page:1,search:``,role:``}),V=d(``),H;s(()=>B.search,e=>{H&&clearTimeout(H),H=setTimeout(()=>{V.value=e,B.page=1},300)});let U=p(()=>({page:B.page,search:V.value||void 0,role:B.role||void 0,page_size:20})),W=r(U),G=n(),K=e(),ce=t(),le=p(()=>W.data.value?.results??[]),q=p(()=>W.data.value?.count??0),ue=p(()=>Math.max(1,Math.ceil(q.value/R))),J=d(null),Y=d(!1),X=u({user_id:``,role_slug:``,expires_at:null,note:``}),Z=p(()=>G.data.value??[]),Q=p(()=>z.can(`role.assign`)),de=e=>{Q.value&&(J.value=e,X.user_id=e.id,X.role_slug=``,X.expires_at=null,X.note=``,Y.value=!0)},fe=async()=>{if(!X.role_slug){E.warning(`Select a role to assign`);return}try{await K.mutateAsync({...X}),E.success(`Role assigned`),Y.value=!1}catch{E.error(`Failed to assign role`)}},pe=async(e,t)=>{try{await ce.mutateAsync({user_id:e.id,role_slug:t}),E.success(`Role revoked`)}catch{E.error(`Failed to revoke role`)}},$=e=>{let t=e.roles??[];return t.map(e=>{if(typeof e==`string`){let t=Z.value.find(t=>t.slug===e);return{name:t?.name??e,slug:t?.slug??e}}return{name:e.name,slug:e.slug}})};return(e,t)=>{let n=C(`el-input`),r=C(`el-option`),i=C(`el-select`),s=C(`el-tag`),u=C(`el-table-column`),d=C(`el-icon`),p=C(`el-button`),b=C(`el-table`),E=C(`el-pagination`),z=C(`el-card`),V=C(`el-date-picker`),H=C(`el-dialog`),U=ee(`loading`);return x(),_(o,null,[m(`div`,O,[y(D,{class:`hidden md:flex`}),m(`main`,k,[m(`header`,A,[m(`div`,j,[t[8]||=m(`div`,null,[m(`p`,{class:`text-sm uppercase tracking-widest text-gray-400`},`Admin`),m(`h1`,{class:`text-2xl font-semibold text-gray-900`},`User Directory`)],-1),m(`div`,M,[y(n,{modelValue:B.search,"onUpdate:modelValue":t[0]||=e=>B.search=e,size:`large`,placeholder:`Search by name, email, or role`,"prefix-icon":`Search`,clearable:``,class:`w-full sm:w-72`},null,8,[`modelValue`]),y(i,{modelValue:B.role,"onUpdate:modelValue":t[1]||=e=>B.role=e,placeholder:`All roles`,clearable:``,size:`large`},{default:c(()=>[y(r,{label:`All roles`,value:``}),(x(!0),_(o,null,S(Z.value,e=>(x(),h(r,{key:e.slug,label:e.name,value:e.slug},null,8,[`label`,`value`]))),128))]),_:1},8,[`modelValue`])])])]),m(`section`,N,[y(z,{shadow:`never`,class:`border border-gray-200`},{header:c(()=>[m(`div`,te,[m(`div`,null,[m(`p`,ne,`Showing `+T(q.value)+` users`,1)]),f(W).isFetching.value?(x(),h(s,{key:0,size:`small`,type:`info`},{default:c(()=>t[9]||=[v(`Refreshing...`,-1)]),_:1,__:[9]})):g(``,!0)])]),default:c(()=>[l((x(),h(b,{data:le.value,stripe:``},{default:c(()=>[y(u,{label:`User`,"min-width":`220`},{default:c(({row:e})=>[m(`div`,re,[m(`span`,ie,T(e.username||e.email),1),m(`span`,ae,T(e.email),1)])]),_:1}),y(u,{label:`Roles`,"min-width":`200`},{default:c(({row:e})=>[m(`div`,oe,[(x(!0),_(o,null,S($(e),t=>(x(),h(s,{key:t.slug,type:`info`,size:`small`},{default:c(()=>[v(T(t.name)+` `,1),Q.value?(x(),h(d,{key:0,class:`ml-1 cursor-pointer`,onClick:a(n=>pe(e,t.slug),[`stop`])},{default:c(()=>[(x(),h(w(`Close`)))]),_:2},1032,[`onClick`])):g(``,!0)]),_:2},1024))),128)),$(e).length===0?(x(),_(`span`,se,` No roles `)):g(``,!0)])]),_:1}),y(u,{label:`Status`,width:`150`},{default:c(({row:e})=>[y(s,{type:e.is_disabled?`danger`:`success`,size:`small`},{default:c(()=>[v(T(e.is_disabled?`Disabled`:`Active`),1)]),_:2},1032,[`type`])]),_:1}),y(u,{label:`Last login`,width:`180`},{default:c(({row:e})=>[m(`span`,P,T(e.last_login?new Date(e.last_login).toLocaleString():`â€”`),1)]),_:1}),y(u,{label:`Actions`,width:`160`,align:`right`},{default:c(({row:e})=>[y(p,{size:`small`,type:`primary`,plain:``,disabled:!Q.value,onClick:t=>de(e)},{default:c(()=>t[10]||=[v(` Assign role `,-1)]),_:2,__:[10]},1032,[`disabled`,`onClick`])]),_:1})]),_:1},8,[`data`])),[[U,f(W).isLoading.value]]),m(`div`,F,[m(`span`,I,` Page `+T(B.page)+` of `+T(ue.value),1),y(E,{layout:`prev, pager, next`,total:q.value,"page-size":R,"current-page":B.page,onCurrentChange:t[2]||=e=>B.page=e},null,8,[`total`,`current-page`])])]),_:1})])])]),y(H,{modelValue:Y.value,"onUpdate:modelValue":t[7]||=e=>Y.value=e,title:`Assign role to ${J.value?.username||J.value?.email||``}`,width:`420px`},{footer:c(()=>[y(p,{onClick:t[6]||=e=>Y.value=!1},{default:c(()=>t[11]||=[v(`Cancel`,-1)]),_:1,__:[11]}),y(p,{type:`primary`,loading:f(K).isPending.value,onClick:fe},{default:c(()=>t[12]||=[v(` Assign role `,-1)]),_:1,__:[12]},8,[`loading`])]),default:c(()=>[m(`div`,L,[y(i,{modelValue:X.role_slug,"onUpdate:modelValue":t[3]||=e=>X.role_slug=e,placeholder:`Select role`,class:`w-full`,loading:f(G).isLoading.value},{default:c(()=>[(x(!0),_(o,null,S(Z.value,e=>(x(),h(r,{key:e.slug,label:e.name,value:e.slug},null,8,[`label`,`value`]))),128))]),_:1},8,[`modelValue`,`loading`]),y(V,{modelValue:X.expires_at,"onUpdate:modelValue":t[4]||=e=>X.expires_at=e,type:`date`,placeholder:`Optional expiration`,class:`w-full`,"value-format":`YYYY-MM-DD`},null,8,[`modelValue`]),y(n,{modelValue:X.note,"onUpdate:modelValue":t[5]||=e=>X.note=e,type:`textarea`,placeholder:`Optional note`,rows:3},null,8,[`modelValue`])])]),_:1},8,[`modelValue`,`title`])],64)}}}),B=z;export{B as default};